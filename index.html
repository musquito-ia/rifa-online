<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rifa - TV Smart 50" ğŸ“º</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .numero-disponivel { 
            background: #f0fdf4; 
            border: 2px solid #86efac;
            cursor: pointer;
        }
        .numero-disponivel:hover {
            background: #dcfce7;
            transform: scale(1.05);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .numero-vendido { 
            background: #fef3c7; 
            border: 2px solid #fbbf24;
            cursor: not-allowed;
            opacity: 0.6;
        }
        .numero-pago { 
            background: #dcfce7; 
            border: 2px solid #22c55e;
            cursor: not-allowed;
            opacity: 0.6;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-yellow-50 to-orange-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl shadow-2xl p-8 mb-8 text-white">
            <div class="text-center">
                <h1 class="text-4xl font-bold mb-2">ğŸ² RIFA - JOGO DO BICHO ğŸ²</h1>
                <p class="text-2xl font-bold mb-4">ğŸ“º TV SMART 50 POLEGADAS ğŸ“º</p>
                <div class="flex flex-wrap justify-center gap-4 text-lg">
                    <div>ğŸ’° <strong>Dezena:</strong> R$ 100,00</div>
                    <div>ğŸ’µ <strong>Sem Grupo:</strong> R$ 80,00</div>
                </div>
            </div>
        </div>

        <!-- InformaÃ§Ãµes de Pagamento -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">ğŸ’³ InformaÃ§Ãµes de Pagamento</h3>
            <div class="grid md:grid-cols-2 gap-4 max-w-2xl mx-auto">
                <div class="bg-green-50 rounded-lg p-4">
                    <p class="font-bold text-green-800 mb-2">ğŸŒ PIX (Celular):</p>
                    <p class="text-2xl font-mono font-bold text-gray-800">06699666495</p>
                    <button onclick="copiarPix()" class="mt-2 w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600">
                        ğŸ“‹ Copiar PIX
                    </button>
                </div>
                <div class="bg-blue-50 rounded-lg p-4">
                    <p class="font-bold text-blue-800 mb-2">ğŸ‘¤ Nome:</p>
                    <p class="text-lg font-bold text-gray-800">JosÃ© Arnaldo da Silva</p>
                    <p class="font-bold text-blue-800 mt-3">ğŸ¦ Mercado Pago</p>
                </div>
            </div>
        </div>

        <!-- EstatÃ­sticas -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="grid grid-cols-3 gap-4 text-center max-w-2xl mx-auto">
                <div>
                    <div class="text-3xl font-bold text-green-600" id="disponiveis">-</div>
                    <div class="text-sm text-gray-600">DisponÃ­veis</div>
                </div>
                <div>
                    <div class="text-3xl font-bold text-yellow-600" id="vendidos">-</div>
                    <div class="text-sm text-gray-600">Reservados</div>
                </div>
                <div>
                    <div class="text-3xl font-bold text-green-600" id="pagos">-</div>
                    <div class="text-sm text-gray-600">Pagos</div>
                </div>
            </div>
        </div>

        <!-- Grade de NÃºmeros -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">ğŸ”¢ ESCOLHA SEU NÃšMERO DA SORTE ğŸ”¢</h3>
            <p class="text-center text-gray-600 mb-6">Clique em um nÃºmero disponÃ­vel para reservar</p>
            
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3" id="numerosGrid">
                <!-- SerÃ¡ preenchido pelo JavaScript -->
            </div>
        </div>

        <!-- Sorteio Info -->
        <div class="bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl shadow-lg p-6 text-white text-center">
            <h3 class="text-2xl font-bold mb-2">ğŸ² SORTEIO PELA FEDERAL ğŸ²</h3>
            <p class="mb-2">A rifa serÃ¡ realizada assim que todos os nÃºmeros estiverem preenchidos e pagos.</p>
            <p class="text-xl font-bold">ğŸ™ğŸ€ BOA SORTE! ğŸ€ğŸ™</p>
        </div>
    </div>

    <!-- Modal de Reserva -->
    <div id="modalReserva" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full">
            <h3 class="text-2xl font-bold text-gray-800 mb-2 text-center">Reservar NÃºmero</h3>
            <div class="text-center mb-6">
                <div id="modalAnimal" class="text-6xl mb-2"></div>
                <div id="modalNumero" class="text-4xl font-bold text-gray-800"></div>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-semibold text-gray-700 mb-2">Nome Completo:</label>
                <input 
                    type="text" 
                    id="inputNome" 
                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                    placeholder="Digite seu nome..."
                >
            </div>

            <div class="mb-6">
                <label class="block text-sm font-semibold text-gray-700 mb-2">Telefone (WhatsApp):</label>
                <input 
                    type="tel" 
                    id="inputTelefone" 
                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                    placeholder="(00) 00000-0000"
                >
            </div>

            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                <p class="text-sm text-yellow-800">
                    <strong>âš ï¸ AtenÃ§Ã£o:</strong> ApÃ³s reservar, faÃ§a o pagamento via PIX e envie o comprovante!
                </p>
            </div>

            <div class="flex gap-3">
                <button onclick="confirmarReserva()" class="flex-1 bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 font-bold">
                    âœ… Confirmar Reserva
                </button>
                <button onclick="fecharModal()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 font-bold">
                    âŒ Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Sucesso -->
    <div id="modalSucesso" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full text-center">
            <div class="text-6xl mb-4">ğŸ‰</div>
            <h3 class="text-2xl font-bold text-green-600 mb-4">Reserva Confirmada!</h3>
            <p class="text-gray-700 mb-6">Seu nÃºmero foi reservado com sucesso! Agora faÃ§a o pagamento via PIX:</p>
            
            <div class="bg-green-50 rounded-lg p-4 mb-6">
                <p class="font-bold text-green-800 mb-2">PIX:</p>
                <p class="text-2xl font-mono font-bold text-gray-800">06699666495</p>
                <button onclick="copiarPix()" class="mt-2 w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600">
                    ğŸ“‹ Copiar PIX
                </button>
            </div>

            <p class="text-sm text-gray-600 mb-4">ApÃ³s o pagamento, envie o comprovante para confirmar!</p>

            <button onclick="fecharModalSucesso()" class="bg-blue-500 text-white py-3 px-8 rounded-lg hover:bg-blue-600 font-bold">
                OK, Entendi!
            </button>
        </div>
    </div>

    <script>
        const API_URL = '';
        let numeros = [];
        let numeroSelecionado = null;

        async function carregarNumeros() {
            try {
                const response = await fetch(`${API_URL}/api/numeros`);
                numeros = await response.json();
                renderizarNumeros();
                atualizarEstatisticas();
            } catch (error) {
                console.error('Erro ao carregar nÃºmeros:', error);
                alert('Erro ao carregar nÃºmeros. Tente novamente.');
            }
        }

        function renderizarNumeros() {
            const grid = document.getElementById('numerosGrid');
            grid.innerHTML = '';

            numeros.forEach(data => {
                const div = document.createElement('div');
                const classe = data.pago ? 'numero-pago' : 
                              data.nome ? 'numero-vendido' : 
                              'numero-disponivel';
                
                div.className = `${classe} p-4 rounded-lg transition-all`;
                
                div.innerHTML = `
                    <div class="text-3xl text-center mb-1">${data.animal}</div>
                    <div class="text-lg font-bold text-center mb-1">
                        ${String(data.numero).padStart(2, '0')}
                    </div>
                    <div class="text-xs text-center">
                        ${data.pago ? 'âœ… Pago' : data.nome ? 'ğŸŸ¡ Reservado' : 'ğŸŸ¢ DisponÃ­vel'}
                    </div>
                `;
                
                if (!data.nome) {
                    div.onclick = () => abrirModal(data.numero, data.animal);
                }
                
                grid.appendChild(div);
            });
        }

        function atualizarEstatisticas() {
            const disponiveis = numeros.filter(n => !n.nome).length;
            const vendidos = numeros.filter(n => n.nome && !n.pago).length;
            const pagos = numeros.filter(n => n.pago).length;

            document.getElementById('disponiveis').textContent = disponiveis;
            document.getElementById('vendidos').textContent = vendidos;
            document.getElementById('pagos').textContent = pagos;
        }

        function abrirModal(numero, animal) {
            numeroSelecionado = numero;
            document.getElementById('modalNumero').textContent = String(numero).padStart(2, '0');
            document.getElementById('modalAnimal').textContent = animal;
            document.getElementById('inputNome').value = '';
            document.getElementById('inputTelefone').value = '';
            document.getElementById('modalReserva').classList.remove('hidden');
            setTimeout(() => document.getElementById('inputNome').focus(), 100);
        }

        function fecharModal() {
            document.getElementById('modalReserva').classList.add('hidden');
            numeroSelecionado = null;
        }

        async function confirmarReserva() {
            const nome = document.getElementById('inputNome').value.trim();
            const telefone = document.getElementById('inputTelefone').value.trim();

            if (!nome) {
                alert('âŒ Por favor, digite seu nome!');
                return;
            }

            if (!telefone) {
                alert('âŒ Por favor, digite seu telefone!');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/reservar`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ numero: numeroSelecionado, nome, telefone })
                });

                const result = await response.json();

                if (response.ok) {
                    fecharModal();
                    document.getElementById('modalSucesso').classList.remove('hidden');
                    await carregarNumeros();
                } else {
                    alert('âŒ ' + result.erro);
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao reservar nÃºmero. Tente novamente.');
            }
        }

        function fecharModalSucesso() {
            document.getElementById('modalSucesso').classList.add('hidden');
        }

        function copiarPix() {
            navigator.clipboard.writeText('06699666495');
            alert('âœ… PIX copiado: 06699666495');
        }

        // Formatar telefone
        document.getElementById('inputTelefone').addEventListener('input', (e) => {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            
            if (value.length > 6) {
                value = `(${value.slice(0, 2)}) ${value.slice(2, 7)}-${value.slice(7)}`;
            } else if (value.length > 2) {
                value = `(${value.slice(0, 2)}) ${value.slice(2)}`;
            } else if (value.length > 0) {
                value = `(${value}`;
            }
            
            e.target.value = value;
        });

        // Carregar ao iniciar e atualizar a cada 10 segundos
        carregarNumeros();
        setInterval(carregarNumeros, 10000);
    </script>
</body>
</html>
